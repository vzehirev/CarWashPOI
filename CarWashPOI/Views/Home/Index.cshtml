@model HomePageOutputModel

@{
    ViewData["Title"] = "Начало";
}

<div id="map" class="mb-4"></div>
<div class="row mx-auto justify-content-center text-center mb-4">
    <a asp-controller="Locations" asp-action="Add" class="btn btn-outline-success">Добави нова локация</a>
</div>

<form class="row mw-100 justify-content-center text-center col-md-8">
    <div class="form-group col-md-2">
        <label>Град</label>
        <select id="town" asp-for="SelectedTownId" name="townId" class="custom-select">
            <option>Всички</option>
            @foreach (var town in Model.AllTowns)
            {
                <option value="@town.Id">@town.Name</option>
            }
        </select>
    </div>
    <div class="form-group col-md-2">
        <label>Тип</label>
        <select id="type" asp-for="SelectedTypeId" name="typeId" class="custom-select">
            <option>Всички</option>
            @foreach (var locationType in Model.AllTypes)
            {
                <option value="@locationType.Id">@locationType.Type</option>
            }
        </select>
    </div>
    <div class="form-group col-md-2">
        <label>Подредба</label>
        <select asp-for="SelectedOrderBy" name="orderBy" class="custom-select">
            <option value="newestFirst">Най-скоро добавени</option>
            <option value="rating">Оценка</option>
        </select>
    </div>
    <button id="filterAndOrderBtn" type="submit" class="btn btn-success btn-sm">OK</button>
</form>
<div class="row mw-100 justify-content-center m-0 text-center">
    @foreach (var location in Model.Locations)
    {
        <div class="card col-md-3 p-0 m-3">
            <h4 class="card-header">@location.Title</h4>
            <div class="card-body">
                <h5 class="card-title">@location.Address.Town, @location.Address.Neighbourhood</h5>
                <h6 class="card-subtitle text-muted">+ 5 / - 3</h6>
            </div>
            <img style="height: 200px; width: 100%; display: block;" src="data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22318%22%20height%3D%22180%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20318%20180%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_158bd1d28ef%20text%20%7B%20fill%3Argba(255%2C255%2C255%2C.75)%3Bfont-weight%3Anormal%3Bfont-family%3AHelvetica%2C%20monospace%3Bfont-size%3A16pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_158bd1d28ef%22%3E%3Crect%20width%3D%22318%22%20height%3D%22180%22%20fill%3D%22%23777%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%22129.359375%22%20y%3D%2297.35%22%3EImage%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E" alt="Card image">
            <div class="card-body">
                <a asp-controller="Locations" asp-action="LocationDetails" asp-route-id="@location.Id" class="card-link btn btn-outline-primary">Детайли</a>
            </div>
            <div class="card-footer text-muted">
                20-Jan-2015
            </div>
        </div>
    }
    @if (Model.Locations.Count() == 0)
    {
        <p class="text-secondary">Не бяха открити резултати.</p>
    }

</div>

@* pagination *@
@{
    var parameters = new
    {
        townId = Model.SelectedTownId,
        typeId = Model.SelectedTypeId,
        orderBy = Model.SelectedOrderBy,
    };
}

<div>
    <ul class="pagination justify-content-center">

        @if (Model.CurrentPage == 1)
        {
            <li class="page-item disabled">
                <a class="page-link" href="#">&laquo;</a>
            </li>
        }
        else if (Model.CurrentPage > 1)
        {
            <li class="page-item">
                <a class="page-link" href="@Url.Action("Index", parameters)&page=1">&laquo;</a>
            </li>
        }

        @{
            // -5 and +5 so it can show 5 pages before and 5 pages ahead (if available) of the current one
            int firstPageToShow = Model.CurrentPage - 5 < 1 ? 1 : Model.CurrentPage - 5;
            int lastPageToShow = Model.CurrentPage + 5 > Model.LastPage ? Model.LastPage : Model.CurrentPage + 5;

            for (int i = firstPageToShow; i <= lastPageToShow; i++)
            {
                if (Model.CurrentPage == i)
                {
                    <li class="page-item active">
                        <a class="page-link" href="#">@i</a>
                    </li>
                }
                else
                {
                    <li class="page-item">
                        <a class="page-link" href="@Url.Action("Index", parameters)&page=@i">@i</a>
                    </li>
                }
            }
        }

        @if (Model.CurrentPage < Model.LastPage)
        {
            <li class="page-item">
                <a class="page-link" href="@Url.Action("Index", parameters)&page=@Model.LastPage">&raquo;</a>
            </li>
        }
        else if (Model.AllCases > 0)
        {
            <li class="page-item disabled">
                <a class="page-link" href="#">&raquo;</a>
            </li>
        }

    </ul>
</div>

@section Scripts {
    <partial name="MapIncludesPartial" />
    <partial name="MapJsPartial" />
}
